{% extends "manager/layout.html" %}
{% load crispy_forms_tags %}
{% block pages %}
    <div class="col-8">
        <div class="chartBox">
            <canvas id="myExpenseChart" width="300" height="175" ></canvas>
            {% comment %} <canvas id="monthlyChart"></canvas>
            <button id="prevMonth">Previous Month</button>
            <button id="nextMonth">Next Month</button> {% endcomment %}
        </div>
        <hr>
        <div class="box">
            <h1>History</h1>

            {% for expense in expenses %}
            <hr>
                <article class="media content-section">
                    <div class="media-body">
                        <div class="article-metadata">
                           <div class= "left-buttons">
                            <div>
                                <div class="h4 mb-0 mt-0"> Amount: {{ expense.Amount }}</div>
                                <small class="h6 text-muted mb-3">{{ expense.ExpenseDate|date:"F d, Y" }}</small>
                            </div>
                            <div>
                                <a class="inside-button mr-0" href="{% url "updateExpense" expense.Expense_id %}">
                                    <button type="button" class="edit-button">Edit</button>
                                </a>
                                <a class="inside-button mr-0" href="{% url "deleteExpense" expense.Expense_id %}" class="ml-2">
                                    <button type="button" class="delete-button">Delete</button>
                                </a>
                            </div>
                           </div>
                        </div>
                    </div>
                </article>
            {% endfor %}
            <hr>
            <br/>
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                    <div class="page-item">
                        {% if expenses.has_previous or expenses.has_next  %}
                            {% if expenses.has_previous %}
                                <a  href="?page=1"><button class="page-link">&laquo First</button></a>
                                <a href="?page={{ expenses.previous_page_number }}"><button class="page-link">Previous</button></a>
                            {% else %}
                                <button class="page-link fade">&laquo First</button>
                                <button class="page-link fade">Previous</button>
                            {% endif %}
                            <!--
                            <li class="page-item disabled"><a href="#" class="page-link">Page {{ venues.number }} of {{ venues.paginator.num_pages }}</a></li>
                            -->
                            
                            {% for expense in paginator.num_pages %}
                                <a href="?page={{ expense.counter }}"><button class="page-link">{{ expense.counter }}</button></a>
                            {% endfor %}
                            
                            {% if expenses.has_next %}
                                <a href="?page={{ expenses.next_page_number }}"><button class="page-link">Next</button></a>
                                <a href="?page={{ expenses.paginator.num_pages }}"><button class="page-link">Last &raquo</button></a>
                            {% else %}
                                <button class="page-link fade">Next</button>
                                <button class="page-link fade">Last &raquo</button>
                            {% endif %}
                        {% else %}
                            <button class="page-link fade">&laquo First</button>
                            <button class="page-link fade">Previous</button>
                            <button class="page-link fade">Next</button>
                            <button class="page-link fade">Last &raquo</button>
                        {% endif %}
                    </div>
                </ul>
            </nav>
            <br/>
        </div>
    </div>
    <div class="col-4">
        <div class="message">
            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} justify-content-center">
                {{ message }}
                <a href="../" class="del-msg">&times;</a>
            </div>
            {% endfor %}
            {% endif %}
        </div>
        <div class="data-section">
            <form method="post">
                {% csrf_token %}
                <fieldset class="form-group">
                    <legend class="border-bottom mb-4">Expense</legend>
                    {{ form|crispy }}
                </fieldset>
                <div class="form-group">
                    <button class="btn btn-outline-info" type="submit">Submit</button>
                </div>
            </form>
        </div>
    </div>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
    <script>
        // setup 
        const dates = {{ labels|safe }};
        const amount = {{ money|safe }};
        const data = {
            labels: dates,
            datasets: [{
                label: 'Expense',
                data: amount,
                backgroundColor: 'rgba(144, 168, 190, 0.5)',
                borderColor: '#5f788a',
                borderWidth: 1,
            }]
        };
        
        // config 
        const config = {
            type: 'bar',
            data,
            options: {
                scales: {
                    x: {
                        grid: {
                            display: false
                          }
                    },        
                    y: {
                        
                        beginAtZero: true
                    }
                }
            }
        };
        
        // render init block
        const myChart = new Chart(
            document.getElementById('myExpenseChart'),
            config
        );

        function filterData(){
            const dates2 = [...dates];
            console.log(dates2);
            const startdate = document.getElementById('startdate')
            console.log(startdate.value)
            const enddate = document.getElementById('enddate')
            const indexstartdate = dates2.indexOf(startdate.value);
            const indexenddate = dates2.indexOf(enddate.value);
            console.log(indexstartdate)
            console.log(indexenddate)
            const filterDate = dates2.slice(dates2.indexOf(startdate.value), dates2.indexOf(enddate.value)+1);
            console.log(filterDate);
        }

    </script>          
    <script>
        $(document).ready(function() {
            // messages timeout for 10 sec 
            setTimeout(function() {
                $('.message').fadeOut('slow');
            }, 10000); // <-- time in milliseconds, 1000 =  1 sec
    
            // delete message
            $('.del-msg').live('click',function(){
                $('.del-msg').parent().attr('style', 'display:none;');
            })
        });
    </script>             












{% comment %} 


    <script>
        var ctx = document.getElementById('monthlyChart').getContext('2d');
        var data = JSON.parse('{{ data|safe }}');
        
        const dates = {{ labels|safe }};
        const amount = {{ money|safe }};
        var chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Monthly Data',
                    data: amount,
                    borderColor: 'rgb(75, 192, 192)',
                    borderWidth: 2,
                }]
            },
            options: {
                responsive: true,
            }
        });
    
        // Add event listeners to the "Previous" and "Next" buttons
        document.getElementById('prevMonth').addEventListener('click', function () {
            // Load data for the previous month and update the chart
        });
    
        document.getElementById('nextMonth').addEventListener('click', function () {
            // Load data for the next month and update the chart
        });
    </script> {% endcomment %}
    {% endblock pages %}